<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M.I.N.N.E.S.O.T.A. - Minnesota Institute for Not Necessarily Evidence-Supported Observations, Theories, and Anecdotes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Linux Libertine', 'Georgia', 'Times', serif;
            line-height: 1.6;
            background: #f6f6f6;
        }

        .header {
            background: #a7d8f0;
            border-bottom: 3px solid #a2a9b1;
            padding: 0.5em 0;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .logo {
            font-size: 1.8em;
            font-weight: bold;
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }

        .logo-subtitle {
            font-size: 0.4em;
            font-weight: normal;
            color: #333;
            display: block;
            margin-top: 2px;
            font-style: italic;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
            padding: 20px;
        }

        .sidebar {
            width: 250px;
            background: white;
            border: 1px solid #a2a9b1;
            padding: 15px;
            height: fit-content;
            border-radius: 3px;
        }

        .sidebar h3 {
            background: #eaecf0;
            margin: -15px -15px 10px -15px;
            padding: 8px 15px;
            font-size: 0.95em;
            border-bottom: 1px solid #a2a9b1;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin: 5px 0;
        }

        .sidebar a {
            color: #0645ad;
            text-decoration: none;
            display: block;
            padding: 2px 5px;
            border-radius: 2px;
            cursor: pointer;
        }

        .sidebar a:hover {
            background: #f8f9fa;
        }

        .sidebar a.active {
            background: #0645ad;
            color: white;
        }

        .article-list-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 3px;
            margin-bottom: 15px;
        }

        .article-list-container::-webkit-scrollbar {
            width: 8px;
        }

        .article-list-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .article-list-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .article-list-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        #article-list {
            padding: 5px;
        }

        .admin-link {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
        }

        .admin-link a {
            font-size: 0.85em;
            color: #666;
            font-style: italic;
        }
        
        .last-updated {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #e0e0e0;
            font-size: 0.8em;
            color: #666;
        }

        .content {
            flex: 1;
            background: white;
            border: 1px solid #a2a9b1;
            padding: 20px;
            border-radius: 3px;
        }

        .article-title {
            font-size: 2.2em;
            font-weight: normal;
            margin-bottom: 10px;
            border-bottom: 3px solid #a2a9b1;
            padding-bottom: 5px;
            position: relative;
        }

        .permalink {
            position: absolute;
            right: 0;
            bottom: 8px;
            font-size: 0.4em;
            color: #666;
            text-decoration: none;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .permalink:hover {
            opacity: 1;
            color: #0645ad;
        }

        .article-content h2 {
            font-size: 1.5em;
            margin: 20px 0 10px 0;
            border-bottom: 1px solid #a2a9b1;
            padding-bottom: 2px;
        }

        .article-content h3 {
            font-size: 1.2em;
            margin: 15px 0 8px 0;
        }

        .article-content p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .infobox {
            float: right;
            width: 300px;
            margin: 0 0 15px 15px;
            border: 1px solid #a2a9b1;
            background: #f8f9fa;
            font-size: 0.9em;
        }

        .infobox-title {
            background: #ccccff;
            padding: 5px 10px;
            font-weight: bold;
            text-align: center;
        }

        .infobox-content {
            padding: 10px;
        }

        .infobox-row {
            display: flex;
            margin: 5px 0;
        }

        .infobox-label {
            font-weight: bold;
            width: 100px;
            flex-shrink: 0;
        }

        .search-container {
            margin: 20px 0;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #a2a9b1;
            border-radius: 2px;
            font-size: 14px;
        }

        .btn {
            background: #0645ad;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn:hover {
            background: #0b0080;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #54595d;
        }

        .btn-secondary:hover {
            background: #495057;
        }

        .edit-form {
            display: none;
        }

        .edit-form textarea {
            width: 100%;
            height: 400px;
            padding: 10px;
            border: 1px solid #a2a9b1;
            border-radius: 3px;
            font-family: monospace;
            font-size: 14px;
        }

        .form-group {
            margin: 15px 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #a2a9b1;
            border-radius: 2px;
        }

        .admin-controls {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border: 1px solid #a2a9b1;
            border-radius: 3px;
            position: relative;
        }

        .admin-controls .version-info {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 11px;
            color: #666;
            background: #fff;
            padding: 2px 6px;
            border-radius: 2px;
            border: 1px solid #ddd;
        }

        .save-status {
            margin: 10px 0;
            padding: 8px;
            border-radius: 3px;
            font-size: 12px;
            text-align: center;
        }

        .save-status.saving {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .save-status.saved {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .save-status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .big-save-btn {
            font-size: 16px !important;
            padding: 12px 24px !important;
            margin: 10px 5px !important;
            min-width: 120px;
            position: relative;
        }

        .admin-spacing {
            margin-top: 30px;
        }

        .hidden {
            display: none !important;
        }

        .error {
            color: #d33;
            background: #fee;
            padding: 10px;
            border: 1px solid #fcc;
            border-radius: 3px;
            margin: 10px 0;
        }

        .success {
            color: #396;
            background: #efe;
            padding: 10px;
            border: 1px solid #cfc;
            border-radius: 3px;
            margin: 10px 0;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                padding: 10px;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .infobox {
                float: none;
                width: 100%;
                margin: 15px 0;
            }

            .article-list-container {
                max-height: 200px;
            }

            .logo {
                font-size: 1.4em;
            }

            .logo-subtitle {
                font-size: 0.35em;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="#" class="logo" onclick="showHome()">
                M.I.N.N.E.S.O.T.A.
                <span class="logo-subtitle">Minnesota Institute for Not Necessarily Evidence-Supported Observations, Theories, and Anecdotes</span>
            </a>
        </div>
    </header>

    <div class="main-container" data-dashlane-rid="fc178961d89456ee" data-dashlane-classification="login">
        <aside class="sidebar">
            <h3>Articles</h3>
            <div class="article-list-container">
                <ul id="article-list"><li><a href="#" onclick="showHome()">Main Page</a></li><li><a href="#giant-paul-bunyan" onclick="showArticle('giant-paul-bunyan')">The Giant Paul Bunyan Incident of 1987</a></li><li><a href="#minnesota-goodbye" onclick="showArticle('minnesota-goodbye')">The Minnesota Goodbye</a></li><li><a href="#hotdish-wars" onclick="showArticle('hotdish-wars')">The Great Hotdish Wars</a></li><li><a href="#lake-monster" onclick="showArticle('lake-monster')">Lake Minnetonka Monster</a></li></ul>
            </div>
            
            <h3>Search</h3>
            <div class="search-container" data-dashlane-rid="3bc256d88b14c827">
                <input type="text" class="search-input" placeholder="Search M.I.N.N.E.S.O.T.A..." id="search-input" onkeyup="handleSearch(event)" data-dashlane-rid="f39f7911d6661f89" data-dashlane-classification="username" data-kwimpalastatus="dead">
                <button onclick="performSearch()" class="btn" style="margin-top: 5px; width: 100%; font-size: 12px; padding: 4px 8px;" data-dashlane-label="true" data-dashlane-rid="57ec33b395ca20a3" data-dashlane-classification="action,search">Search</button>
            </div>

            <div class="admin-link">
                <a href="#admin" onclick="showArticle('admin')" class="active">Login</a>
                <div class="last-updated">
                    <strong>Last Ope-dated:</strong><br>
                    <span id="public-last-updated">7/31/2025, 3:11:07 PM</span>
                </div>
            </div>

            <div id="admin-sidebar" class="">
                <h3>Admin Tools</h3>
                <ul>
                    <li><a href="#" onclick="showNewArticleForm()">Create New Article</a></li>
                    <li><a href="#" onclick="showEditForm()">Edit Current Article</a></li>
                </ul>
            </div>
        </aside>

        <main class="content"><div class="success">Article deleted successfully.</div>
            <div id="article-content" style="display: block;">
                    <h1 class="article-title">
                        Admin Panel
                        <a href="#admin" class="permalink">Â¶</a>
                    </h1>
                    <div class="article-content">
                        <div id="admin-login-section" class="admin-spacing hidden">
                    <p>This is the administrative control panel for M.I.N.N.E.S.O.T.A. Please log in to access editing functions.</p>
                    
                    <div class="form-group">
                        <label for="admin-login-password">Admin Password:</label>
                        <input type="password" id="admin-login-password" placeholder="Enter admin password" onkeyup="handleAdminLoginKeypress(event)">
                    </div>
                    <div class="admin-controls">
                        <button onclick="handleAdminLogin()" class="btn" id="login-btn">Login</button>
                    </div>
                </div>
                
                <div id="admin-dashboard" class="">
                    <div id="save-status" class="save-status saving">ðŸ’¾ Saving to GitHub...</div>
                    
                    <p><strong>Welcome, Administrator!</strong> You now have access to all Institute editing functions.</p>
                    
                    <h2>Quick Actions</h2>
                    <div class="admin-controls">
                        <div class="version-info">v1.0.0</div>
                        <button onclick="showNewArticleForm()" class="btn">Create New Article</button>
                        <button onclick="showEditForm()" class="btn btn-secondary">Edit Current Article</button>
                        <button onclick="showGitHubConfig()" class="btn btn-secondary">GitHub Settings</button>
                        <button onclick="saveWikiToGitHub()" class="btn big-save-btn" id="big-save-btn" style="background: #28a745;">ðŸ’¾ Save All to GitHub</button>
                        <button onclick="handleAdminLogout()" class="btn" style="background: #dc3545;">Logout</button>
                    </div>
                    
                    <h2>Article Management</h2>
                    <div id="article-management">
                        <p>Current research documents in the Institute archives:</p>
                        <ul id="admin-article-list"><li>Welcome to M.I.N.N.E.S.O.T.A. 
                            <button onclick="editArticle('home')" class="btn" style="font-size: 10px; padding: 2px 6px; margin-left: 10px;">Edit</button>
                            <button onclick="deleteArticle('home')" class="btn" style="font-size: 10px; padding: 2px 6px; margin-left: 5px; background: #dc3545;">Delete</button></li><li>The Giant Paul Bunyan Incident of 1987 
                            <button onclick="editArticle('giant-paul-bunyan')" class="btn" style="font-size: 10px; padding: 2px 6px; margin-left: 10px;">Edit</button>
                            <button onclick="deleteArticle('giant-paul-bunyan')" class="btn" style="font-size: 10px; padding: 2px 6px; margin-left: 5px; background: #dc3545;">Delete</button></li><li>The Minnesota Goodbye 
                            <button onclick="editArticle('minnesota-goodbye')" class="btn" style="font-size: 10px; padding: 2px 6px; margin-left: 10px;">Edit</button>
                            <button onclick="deleteArticle('minnesota-goodbye')" class="btn" style="font-size: 10px; padding: 2px 6px; margin-left: 5px; background: #dc3545;">Delete</button></li><li>The Great Hotdish Wars 
                            <button onclick="editArticle('hotdish-wars')" class="btn" style="font-size: 10px; padding: 2px 6px; margin-left: 10px;">Edit</button>
                            <button onclick="deleteArticle('hotdish-wars')" class="btn" style="font-size: 10px; padding: 2px 6px; margin-left: 5px; background: #dc3545;">Delete</button></li><li>Lake Minnetonka Monster 
                            <button onclick="editArticle('lake-monster')" class="btn" style="font-size: 10px; padding: 2px 6px; margin-left: 10px;">Edit</button>
                            <button onclick="deleteArticle('lake-monster')" class="btn" style="font-size: 10px; padding: 2px 6px; margin-left: 5px; background: #dc3545;">Delete</button></li></ul>
                        <p style="font-size: 12px; color: #666; margin-top: 10px;">
                            Last saved: <span id="last-saved-time">Never</span>
                        </p>
                    </div>
                    
                    <h2>Version History</h2>
                    <div id="version-history" class="admin-controls">
                        <p style="font-size: 12px; color: #666;">Current version: <strong id="current-version-display">1.0.0</strong></p>
                        <p style="font-size: 11px; color: #888;">Auto-incremented on each save to GitHub</p>
                        <button onclick="showVersionHistory()" class="btn btn-secondary" style="font-size: 11px; padding: 4px 8px;">View History</button>
                    </div>
                </div>
                    </div>
                </div>

            <div id="edit-content" class="edit-form" style="display: none;">
                <h1 class="article-title">Edit Article</h1>
                <form onsubmit="saveArticle(event)" data-dashlane-rid="92131801bd0c7969" data-dashlane-classification="other">
                    <div class="form-group">
                        <label for="edit-title">Article Title:</label>
                        <input type="text" id="edit-title" required="" data-dashlane-rid="517293bdd942d3db" data-dashlane-classification="title,job" data-dashlane-filled-by-user="true" data-kwimpalastatus="dead">
                    </div>
                    <div class="form-group">
                        <label for="edit-slug">URL Slug:</label>
                        <input type="text" id="edit-slug" required="" placeholder="lowercase-with-hyphens" data-dashlane-rid="aec8f00369cc7e56" data-dashlane-classification="other">
                    </div>
                    <div class="form-group">
                        <label for="edit-content-area">Content (HTML allowed):</label>
                        <textarea id="edit-content-area" required="" placeholder="Enter your article content here..." data-dashlane-rid="2dc74203d5640c23" data-dashlane-classification="other"></textarea>
                    </div>
                    <div class="admin-controls">
                        <button type="submit" class="btn" data-dashlane-label="true" data-dashlane-rid="5b4ef10194bc44b9" data-dashlane-classification="action">Save Article</button>
                        <button onclick="saveArticleAndBackup()" class="btn big-save-btn" style="background: #28a745;" data-dashlane-label="true" data-dashlane-rid="d3371f947cc21c8c" data-dashlane-classification="action">ðŸ’¾ Save &amp; Backup to GitHub</button>
                        <button type="button" class="btn btn-secondary" onclick="cancelEdit()" data-dashlane-label="true" data-dashlane-rid="dda783610320c0ee" data-dashlane-classification="other">Cancel</button>
                        <button type="button" class="btn btn-secondary" onclick="deleteCurrentArticle()" style="background: #dc3545;" data-dashlane-label="true" data-dashlane-rid="8a78625011fef080" data-dashlane-classification="other">Delete Article</button>
                    </div>
                </form>
            </div>
            
            <div id="github-content" class="edit-form" style="display: none;">
                <h1 class="article-title">GitHub Configuration</h1>
                <div class="article-content">
                    <p><strong>Authentication Status:</strong> <span id="auth-status" style="color: rgb(51, 153, 102);">Authenticated with GitHub token</span></p>
                    <p>GitHub token will be retrieved automatically upon successful authentication.</p>
                </div>
                <div class="form-group">
                    <label for="gh-owner">Repository Owner:</label>
                    <input type="text" id="gh-owner" placeholder="GitHub username or organization">
                </div>
                <div class="form-group">
                    <label for="gh-repo">Repository Name:</label>
                    <input type="text" id="gh-repo" placeholder="Repository name">
                </div>
                <div class="form-group">
                    <label for="gh-branch">Branch:</label>
                    <input type="text" id="gh-branch" placeholder="Branch name (e.g., main)" value="main">
                </div>
                <div class="form-group">
                    <label for="gh-path">File Path:</label>
                    <input type="text" id="gh-path" placeholder="Path to HTML file (e.g., index.html)" value="index.html">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        This entire wiki will be saved as a single HTML file
                    </small>
                </div>
                <div class="admin-controls">
                    <button onclick="saveGitHubConfig()" class="btn">Save Configuration</button>
                    <button onclick="testGitHubConnection()" class="btn btn-secondary">Test Connection</button>
                    <button onclick="saveWikiToGitHub()" class="btn">Save Wiki to GitHub</button>
                    <button onclick="loadWikiFromGitHub()" class="btn btn-secondary">Load from GitHub</button>
                    <button type="button" class="btn btn-secondary" onclick="showArticle('admin')">Back to Admin</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Configuration - Cloudflare Pages Functions are served at /api/* not /functions/api/*
        const API_BASE_URL = '/api'; // Correct path for Cloudflare Pages Functions
        
        // Test function - you can run this in the browser console
        window.testAuthEndpoint = async function() {
            console.log('Testing auth endpoint...');
            
            // Test GET request first
            try {
                const getResponse = await fetch(`${API_BASE_URL}/auth`);
                console.log('GET Response status:', getResponse.status);
                const getData = await getResponse.json();
                console.log('GET Response data:', getData);
            } catch (e) {
                console.error('GET test failed:', e);
            }
            
            // Test POST request
            try {
                const postResponse = await fetch(`${API_BASE_URL}/auth`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: 'BenRocks' })
                });
                console.log('POST Response status:', postResponse.status);
                const postData = await postResponse.json();
                console.log('POST Response data:', postData);
            } catch (e) {
                console.error('POST test failed:', e);
            }
        };
        
        // State management
        let isLoggedIn = false;
        let currentArticle = 'home';
        let githubToken = null;
        let lastSaved = new Date('2025-07-31T15:11:07'); // Set to current date/time
        let saveInProgress = false;
        let wikiVersion = '1.0.0';
        
        // GitHub configuration - will be saved to localStorage
        let githubConfig = {
            owner: 'BenSweaterVest',
            repo: 'MinnesotaFacts',
            branch: 'main',
            path: 'index.html'
        };
        
        // Sample articles data
        let articles = {
        "admin": {
                "title": "Admin Panel",
                "content": "\u003cdiv id=\"admin-login-section\" class=\"admin-spacing\"\u003e\n                    \u003cp\u003eThis is the administrative control panel for M.I.N.N.E.S.O.T.A. Please log in to access editing functions.\u003c/p\u003e\n                    \n                    \u003cdiv class=\"form-group\"\u003e\n                        \u003clabel for=\"admin-login-password\"\u003eAdmin Password:\u003c/label\u003e\n                        \u003cinput type=\"password\" id=\"admin-login-password\" placeholder=\"Enter admin password\" onkeyup=\"handleAdminLoginKeypress(event)\"\u003e\n                    \u003c/div\u003e\n                    \u003cdiv class=\"admin-controls\"\u003e\n                        \u003cbutton onclick=\"handleAdminLogin()\" class=\"btn\" id=\"login-btn\"\u003eLogin\u003c/button\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n                \n                \u003cdiv id=\"admin-dashboard\" class=\"hidden\"\u003e\n                    \u003cdiv id=\"save-status\" class=\"save-status hidden\"\u003e\u003c/div\u003e\n                    \n                    \u003cp\u003e\u003cstrong\u003eWelcome, Administrator!\u003c/strong\u003e You now have access to all Institute editing functions.\u003c/p\u003e\n                    \n                    \u003ch2\u003eQuick Actions\u003c/h2\u003e\n                    \u003cdiv class=\"admin-controls\"\u003e\n                        \u003cdiv class=\"version-info\"\u003ev1.0.0\u003c/div\u003e\n                        \u003cbutton onclick=\"showNewArticleForm()\" class=\"btn\"\u003eCreate New Article\u003c/button\u003e\n                        \u003cbutton onclick=\"showEditForm()\" class=\"btn btn-secondary\"\u003eEdit Current Article\u003c/button\u003e\n                        \u003cbutton onclick=\"showGitHubConfig()\" class=\"btn btn-secondary\"\u003eGitHub Settings\u003c/button\u003e\n                        \u003cbutton onclick=\"saveWikiToGitHub()\" class=\"btn big-save-btn\" id=\"big-save-btn\" style=\"background: #28a745;\"\u003eðŸ’¾ Save All to GitHub\u003c/button\u003e\n                        \u003cbutton onclick=\"handleAdminLogout()\" class=\"btn\" style=\"background: #dc3545;\"\u003eLogout\u003c/button\u003e\n                    \u003c/div\u003e\n                    \n                    \u003ch2\u003eArticle Management\u003c/h2\u003e\n                    \u003cdiv id=\"article-management\"\u003e\n                        \u003cp\u003eCurrent research documents in the Institute archives:\u003c/p\u003e\n                        \u003cul id=\"admin-article-list\"\u003e\u003c/ul\u003e\n                        \u003cp style=\"font-size: 12px; color: #666; margin-top: 10px;\"\u003e\n                            Last saved: \u003cspan id=\"last-saved-time\"\u003eNever\u003c/span\u003e\n                        \u003c/p\u003e\n                    \u003c/div\u003e\n                    \n                    \u003ch2\u003eVersion History\u003c/h2\u003e\n                    \u003cdiv id=\"version-history\" class=\"admin-controls\"\u003e\n                        \u003cp style=\"font-size: 12px; color: #666;\"\u003eCurrent version: \u003cstrong id=\"current-version-display\"\u003e1.0.0\u003c/strong\u003e\u003c/p\u003e\n                        \u003cp style=\"font-size: 11px; color: #888;\"\u003eAuto-incremented on each save to GitHub\u003c/p\u
