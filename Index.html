<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minnesota Lore - The Definitive Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Linux Libertine', 'Georgia', 'Times', serif;
            line-height: 1.6;
            background: #f6f6f6;
        }

        .header {
            background: #a7d8f0;
            border-bottom: 3px solid #a2a9b1;
            padding: 0.5em 0;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .logo {
            font-size: 1.8em;
            font-weight: bold;
            color: #000;
            text-decoration: none;
        }

        .auth-section {
            display: flex;
            gap: 10px;
            align-items: center;
            font-size: 0.85em;
        }

        .auth-section #auth-btn {
            background: transparent;
            color: #666;
            border: 1px solid #ccc;
            padding: 4px 8px;
            font-size: 0.8em;
        }

        .auth-section #auth-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        .auth-section #auth-status {
            color: #666;
            font-size: 0.8em;
        }

        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 20px;
            padding: 20px;
        }

        .sidebar {
            width: 250px;
            background: white;
            border: 1px solid #a2a9b1;
            padding: 15px;
            height: fit-content;
            border-radius: 3px;
        }

        .sidebar h3 {
            background: #eaecf0;
            margin: -15px -15px 10px -15px;
            padding: 8px 15px;
            font-size: 0.95em;
            border-bottom: 1px solid #a2a9b1;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin: 5px 0;
        }

        .sidebar a {
            color: #0645ad;
            text-decoration: none;
            display: block;
            padding: 2px 5px;
            border-radius: 2px;
        }

        .sidebar a:hover {
            background: #f8f9fa;
        }

        .sidebar a.active {
            background: #0645ad;
            color: white;
        }

        .content {
            flex: 1;
            background: white;
            border: 1px solid #a2a9b1;
            padding: 20px;
            border-radius: 3px;
        }

        .article-title {
            font-size: 2.2em;
            font-weight: normal;
            margin-bottom: 10px;
            border-bottom: 3px solid #a2a9b1;
            padding-bottom: 5px;
            position: relative;
        }

        .permalink {
            position: absolute;
            right: 0;
            bottom: 8px;
            font-size: 0.4em;
            color: #666;
            text-decoration: none;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .permalink:hover {
            opacity: 1;
            color: #0645ad;
        }

        .article-content h2 {
            font-size: 1.5em;
            margin: 20px 0 10px 0;
            border-bottom: 1px solid #a2a9b1;
            padding-bottom: 2px;
        }

        .article-content h3 {
            font-size: 1.2em;
            margin: 15px 0 8px 0;
        }

        .article-content p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .infobox {
            float: right;
            width: 300px;
            margin: 0 0 15px 15px;
            border: 1px solid #a2a9b1;
            background: #f8f9fa;
            font-size: 0.9em;
        }

        .infobox-title {
            background: #ccccff;
            padding: 5px 10px;
            font-weight: bold;
            text-align: center;
        }

        .infobox-content {
            padding: 10px;
        }

        .infobox-row {
            display: flex;
            margin: 5px 0;
        }

        .infobox-label {
            font-weight: bold;
            width: 100px;
            flex-shrink: 0;
        }

        .search-container {
            margin: 20px 0;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #a2a9b1;
            border-radius: 2px;
            font-size: 14px;
        }

        .btn {
            background: #0645ad;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn:hover {
            background: #0b0080;
        }

        .btn-secondary {
            background: #54595d;
        }

        .btn-secondary:hover {
            background: #495057;
        }

        .edit-form {
            display: none;
        }

        .edit-form textarea {
            width: 100%;
            height: 400px;
            padding: 10px;
            border: 1px solid #a2a9b1;
            border-radius: 3px;
            font-family: monospace;
            font-size: 14px;
        }

        .form-group {
            margin: 15px 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #a2a9b1;
            border-radius: 2px;
        }

        .admin-controls {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border: 1px solid #a2a9b1;
            border-radius: 3px;
        }

        .hidden {
            display: none;
        }

        .error {
            color: #d33;
            background: #fee;
            padding: 10px;
            border: 1px solid #fcc;
            border-radius: 3px;
            margin: 10px 0;
        }

        .success {
            color: #396;
            background: #efe;
            padding: 10px;
            border: 1px solid #cfc;
            border-radius: 3px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                padding: 10px;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .infobox {
                float: none;
                width: 100%;
                margin: 15px 0;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="#" class="logo" onclick="showHome()">Minnesota Lore</a>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <h3>Navigation</h3>
            <ul id="article-list">
                <li><a href="#" onclick="showHome()">Main Page</a></li>
                <li><a href="#admin" onclick="showArticle('admin')">Admin Panel</a></li>
                <li><a href="#giant-paul-bunyan" onclick="showArticle('giant-paul-bunyan')">Giant Paul Bunyan</a></li>
                <li><a href="#minnesota-goodbye" onclick="showArticle('minnesota-goodbye')">The Minnesota Goodbye</a></li>
                <li><a href="#hotdish-wars" onclick="showArticle('hotdish-wars')">The Great Hotdish Wars</a></li>
                <li><a href="#lake-monster" onclick="showArticle('lake-monster')">Lake Minnetonka Monster</a></li>
            </ul>
            
            <h3>Search</h3>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search Minnesota Lore..." id="search-input" onkeyup="handleSearch(event)">
                <button onclick="performSearch()" class="btn" style="margin-top: 5px; width: 100%; font-size: 12px; padding: 4px 8px;">Search</button>
            </div>

            <div id="admin-sidebar" class="hidden">
                <h3>Admin Tools</h3>
                <ul>
                    <li><a href="#" onclick="showNewArticleForm()">Create New Article</a></li>
                    <li><a href="#" onclick="showEditForm()">Edit Current Article</a></li>
                    <li><a href="#" onclick="showGitHubConfig()">GitHub Settings</a></li>
                </ul>
            </div>
        </aside>

        <main class="content">
            <div id="article-content">
                <h1 class="article-title">Welcome to Minnesota Lore</h1>
                <p><strong>Minnesota Lore</strong> is the comprehensive encyclopedia of Minnesota's most important (and completely factual) cultural phenomena, historical events, and legendary figures.</p>
                
                <h2>Featured Articles</h2>
                <p>Discover the rich tapestry of Minnesota's hidden history, from the legendary <a href="#" onclick="showArticle('giant-paul-bunyan')">Giant Paul Bunyan incident of 1987</a> to the ongoing <a href="#" onclick="showArticle('hotdish-wars')">Great Hotdish Wars</a> that have shaped the state's culinary landscape.</p>
                
                <p>Learn about unique Minnesota customs like <a href="#" onclick="showArticle('minnesota-goodbye')">The Minnesota Goodbye</a>, a complex social ritual that can last anywhere from 30 minutes to several hours, and the mysterious <a href="#" onclick="showArticle('lake-monster')">Lake Minnetonka Monster</a> that locals swear exists but somehow never appears in tourist photos.</p>
                
                <h2>About This Wiki</h2>
                <p>This wiki contains 100% accurate* information about Minnesota culture and history. All facts have been thoroughly researched** and verified*** by our team of experts****.</p>
                
                <p style="font-size: 0.8em; color: #666;">
                    *Accuracy not guaranteed<br>
                    **Research may consist of overheard conversations at the State Fair<br>
                    ***Verification process involves asking "Does this sound Minnesota enough?"<br>
                    ****Experts are just people who have lived here for more than one winter
                </p>
            </div>

            <div id="edit-content" class="edit-form">
                <h1 class="article-title">Edit Article</h1>
                <form onsubmit="saveArticle(event)">
                    <div class="form-group">
                        <label for="edit-title">Article Title:</label>
                        <input type="text" id="edit-title" required>
                    </div>
                    <div class="form-group">
                        <label for="edit-slug">URL Slug:</label>
                        <input type="text" id="edit-slug" required placeholder="lowercase-with-hyphens">
                    </div>
                    <div class="form-group">
                        <label for="edit-content-area">Content (HTML allowed):</label>
                        <textarea id="edit-content-area" required placeholder="Enter your article content here..."></textarea>
                    </div>
                    <div class="admin-controls">
                        <button type="submit" class="btn">Save Article</button>
                        <button type="button" class="btn btn-secondary" onclick="cancelEdit()">Cancel</button>
                        <button type="button" class="btn btn-secondary" onclick="deleteCurrentArticle()" style="background: #dc3545;">Delete Article</button>
                    </div>
                </form>
            </div>

            <div id="auth-content" class="edit-form">
                <h1 class="article-title">Admin Authentication</h1>
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="admin-password">Admin Password:</label>
                        <input type="password" id="admin-password" required placeholder="Enter admin password">
                    </div>
                    <div class="admin-controls">
                        <button type="submit" class="btn">Login</button>
                        <button type="button" class="btn btn-secondary" onclick="cancelAuth()">Cancel</button>
                    </div>
                </form>
            </div>

            <div id="github-content" class="edit-form">
                <h1 class="article-title">GitHub Configuration</h1>
                <div class="form-group">
                    <label for="gh-token">GitHub Personal Access Token:</label>
                    <input type="password" id="gh-token" placeholder="Enter your GitHub token">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        Token should have 'repo' permissions for the repository
                    </small>
                </div>
                <div class="form-group">
                    <label for="gh-owner">Repository Owner:</label>
                    <input type="text" id="gh-owner" placeholder="GitHub username or organization">
                </div>
                <div class="form-group">
                    <label for="gh-repo">Repository Name:</label>
                    <input type="text" id="gh-repo" placeholder="Repository name">
                </div>
                <div class="form-group">
                    <label for="gh-branch">Branch:</label>
                    <input type="text" id="gh-branch" placeholder="Branch name (e.g., main)">
                </div>
                <div class="form-group">
                    <label for="gh-path">File Path:</label>
                    <input type="text" id="gh-path" placeholder="Path to HTML file (e.g., index.html)">
                    <small style="color: #666; display: block; margin-top: 5px;">
                        This entire wiki will be saved as a single HTML file
                    </small>
                </div>
                <div class="admin-controls">
                    <button onclick="saveGitHubConfig()" class="btn">Save Configuration</button>
                    <button onclick="testGitHubConnection()" class="btn btn-secondary">Test Connection</button>
                    <button onclick="saveWikiToGitHub()" class="btn">Save Wiki to GitHub</button>
                    <button onclick="loadWikiFromGitHub()" class="btn btn-secondary">Load from GitHub</button>
                    <button type="button" class="btn btn-secondary" onclick="showArticle('admin')">Back to Admin</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Configuration
        const ADMIN_PASSWORD = 'minnesota2024'; // Change this to your desired password
        
        // State management
        let isLoggedIn = false;
        let currentArticle = 'home';
        let githubConfig = {
            token: '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',
            owner: 'BenSweaterVest',
            repo: 'MinnesotaFacts',
            branch: 'main',
            path: 'index.html'
        };
        
        let wikiData = {
            title: 'Minnesota Lore',
            subtitle: 'The Definitive Guide',
            lastModified: new Date().toISOString()
        };
        
        let articles = {
            'admin': {
                title: 'Admin Panel',
                content: `<div id="admin-login-section">
                    <p>This is the administrative control panel for Minnesota Lore. Please log in to access editing functions.</p>
                    
                    <div class="form-group">
                        <label for="admin-login-password">Admin Password:</label>
                        <input type="password" id="admin-login-password" placeholder="Enter admin password" onkeyup="handleAdminLoginKeypress(event)">
                    </div>
                    <div class="admin-controls">
                        <button onclick="handleAdminLogin()" class="btn">Login</button>
                    </div>
                </div>
                
                <div id="admin-dashboard" class="hidden">
                    <p><strong>Welcome, Administrator!</strong> You now have access to all editing functions.</p>
                    
                    <h2>Quick Actions</h2>
                    <div class="admin-controls">
                        <button onclick="showNewArticleForm()" class="btn">Create New Article</button>
                        <button onclick="showEditForm()" class="btn btn-secondary">Edit Current Article</button>
                        <button onclick="showGitHubConfig()" class="btn btn-secondary">GitHub Settings</button>
                        <button onclick="handleAdminLogout()" class="btn" style="background: #dc3545;">Logout</button>
                    </div>
                    
                    <h2>Article Management</h2>
                    <div id="article-management">
                        <p>Current articles in the wiki:</p>
                        <ul id="admin-article-list"></ul>
                    </div>
                    
                    <h2>Data Management</h2>
                    <div class="admin-controls">
                        <button onclick="saveWikiToGitHub()" class="btn">Save Wiki to GitHub</button>
                        <button onclick="loadWikiFromGitHub()" class="btn btn-secondary">Load from GitHub</button>
                        <button onclick="exportArticles()" class="btn btn-secondary">Export JSON</button>
                        <button onclick="showImportForm()" class="btn btn-secondary">Import JSON</button>
                    </div>
                    
                    <div id="import-section" class="hidden" style="margin-top: 15px;">
                        <div class="form-group">
                            <label for="import-data">Paste JSON data:</label>
                            <textarea id="import-data" placeholder="Paste exported JSON data here..." style="height: 150px;"></textarea>
                        </div>
                        <div class="admin-controls">
                            <button onclick="importArticles()" class="btn">Import Articles</button>
                            <button onclick="hideImportForm()" class="btn btn-secondary">Cancel</button>
                        </div>
                    </div>
                </div>`
            },
            'home': {
                title: 'Welcome to Minnesota Lore',
                content: `<p><strong>Minnesota Lore</strong> is the comprehensive encyclopedia of Minnesota's most important (and completely factual) cultural phenomena, historical events, and legendary figures.</p>
                
                <h2>Featured Articles</h2>
                <p>Discover the rich tapestry of Minnesota's hidden history, from the legendary <a href="#" onclick="showArticle('giant-paul-bunyan')">Giant Paul Bunyan incident of 1987</a> to the ongoing <a href="#" onclick="showArticle('hotdish-wars')">Great Hotdish Wars</a> that have shaped the state's culinary landscape.</p>
                
                <p>Learn about unique Minnesota customs like <a href="#" onclick="showArticle('minnesota-goodbye')">The Minnesota Goodbye</a>, a complex social ritual that can last anywhere from 30 minutes to several hours, and the mysterious <a href="#" onclick="showArticle('lake-monster')">Lake Minnetonka Monster</a> that locals swear exists but somehow never appears in tourist photos.</p>
                
                <h2>About This Wiki</h2>
                <p>This wiki contains 100% accurate* information about Minnesota culture and history. All facts have been thoroughly researched** and verified*** by our team of experts****.</p>
                
                <p style="font-size: 0.8em; color: #666;">
                    *Accuracy not guaranteed<br>
                    **Research may consist of overheard conversations at the State Fair<br>
                    ***Verification process involves asking "Does this sound Minnesota enough?"<br>
                    ****Experts are just people who have lived here for more than one winter
                </p>`
            },
            'giant-paul-bunyan': {
                title: 'The Giant Paul Bunyan Incident of 1987',
                content: `<div class="infobox">
                    <div class="infobox-title">Paul Bunyan Incident</div>
                    <div class="infobox-content">
                        <div class="infobox-row">
                            <div class="infobox-label">Date:</div>
                            <div>July 4, 1987</div>
                        </div>
                        <div class="infobox-row">
                            <div class="infobox-label">Location:</div>
                            <div>Bemidji, Minnesota</div>
                        </div>
                        <div class="infobox-row">
                            <div class="infobox-label">Casualties:</div>
                            <div>12 lawn chairs, 1 hot dog stand</div>
                        </div>
                        <div class="infobox-row">
                            <div class="infobox-label">Status:</div>
                            <div>Covered up by Big Tourism</div>
                        </div>
                    </div>
                </div>
                
                <p>The <strong>Giant Paul Bunyan Incident of 1987</strong> remains one of Minnesota's most controversial and heavily suppressed historical events. On July 4th, 1987, during Bemidji's annual Independence Day celebration, the famous Paul Bunyan statue allegedly came to life and went on a brief but destructive rampage through downtown.</p>
                
                <h2>Background</h2>
                <p>The 18-foot tall fiberglass statue of Paul Bunyan had been standing peacefully in Bemidji since 1937. Local folklore suggested that the statue was built on an ancient Native American burial ground specifically dedicated to "really tall lumberjacks," but this was generally dismissed as tourist nonsense until the events of 1987.</p>
                
                <h2>The Incident</h2>
                <p>According to eyewitness accounts (which were later "lost" by city officials), at approximately 2:47 PM, during the peak of the July 4th festivities, the Paul Bunyan statue began to move. Witnesses report that it first turned its head toward the crowd, causing mass hysteria among the estimated 400 attendees.</p>
                
                <p>The statue then allegedly took seven giant steps through downtown Bemidji, crushing Harold Svensson's prize-winning petunias, demolishing Marge's Hot Dog Stand, and stepping on a cluster of folding chairs where the Bemidji Ladies' Auxiliary was selling raffle tickets for a new snowblower.</p>
                
                <h2>Cover-up</h2>
                <p>Within hours, state tourism officials arrived on scene and declared the entire incident a "mass hallucination caused by bad potato salad." All photographic evidence mysteriously disappeared, and witnesses were given free tickets to the State Fair in exchange for their silence.</p>
                
                <p>The official story maintains that a small earthquake caused the statue to "settle" slightly, which some people misinterpreted as movement. This explanation has been accepted by most residents, particularly after the tourism board's generous donation to the local hockey rink renovation fund.</p>
                
                <h2>Legacy</h2>
                <p>Today, the Paul Bunyan statue stands in its original position, though locals note that it now faces a slightly different direction than before 1987. The city has installed a small plaque reading "Definitely Has Never Moved - Please Do Not Feed" at the base of the statue.</p>
                
                <p>Some conspiracy theorists believe the incident was caused by a combination of Fourth of July fireworks, excessive hotdish consumption by nearby picnickers, and a rare atmospheric phenomenon known as "Minnesota Nice Overload."</p>`
            },
            'minnesota-goodbye': {
                title: 'The Minnesota Goodbye',
                content: `<p>The <strong>Minnesota Goodbye</strong> is a complex social ritual practiced throughout Minnesota, characterized by an extended departure process that can last anywhere from 30 minutes to several hours. This phenomenon has been documented by anthropologists as one of the most intricate farewell customs in North America.</p>
                
                <h2>Stages of the Minnesota Goodbye</h2>
                
                <h3>Stage 1: The Initial Announcement (5-10 minutes)</h3>
                <p>The departing party announces their intention to leave with phrases such as "Well, I suppose we should probably get going" or "We don't want to keep you any longer." This announcement is rarely taken seriously by any party involved and serves merely as the opening ceremony of the goodbye process.</p>
                
                <h3>Stage 2: The Kitchen Lingering (10-20 minutes)</h3>
                <p>Participants migrate to the kitchen area, where the conversation continues while standing. Topics typically include weather predictions, upcoming community events, and mutual acquaintances. Someone may offer coffee "for the road," which, if accepted, resets the entire process.</p>
                
                <h3>Stage 3: The Door Approach (5-15 minutes)</h3>
                <p>The group slowly moves toward the exit while maintaining conversation. Progress is frequently halted by the remembrance of additional topics that "absolutely must" be discussed before departure.</p>
                
                <h3>Stage 4: The Threshold Pause (10-30 minutes)</h3>
                <p>Upon reaching the door, participants engage in the most crucial phase of the Minnesota Goodbye. While physically positioned to leave, all parties continue talking. Common subjects include:</p>
                <ul>
                    <li>Detailed weather analysis and forecasting</li>
                    <li>Route planning and traffic conditions</li>
                    <li>Stories about mutual friends or family members</li>
                    <li>Scheduling of future gatherings</li>
                </ul>
                
                <h3>Stage 5: The Vehicle Conversation (5-45 minutes)</h3>
                <p>After finally exiting the building, the conversation continues beside the departing party's vehicle. Winter conditions may extend this phase significantly, as starting the car and warming it up provides additional conversation time.</p>
                
                <h2>Cultural Significance</h2>
                <p>The Minnesota Goodbye serves several important social functions:</p>
                <ul>
                    <li><strong>Politeness Maximization:</strong> Ensures no one feels rushed or unwelcomed</li>
                    <li><strong>Information Exchange:</strong> Allows for comprehensive community updates</li>
                    <li><strong>Relationship Maintenance:</strong> Demonstrates genuine care and interest in others</li>
                    <li><strong>Winter Preparation:</strong> Provides mental conditioning for long indoor conversations during harsh weather</li>
                </ul>
                
                <h2>Regional Variations</h2>
                <p>The Minnesota Goodbye varies slightly across different regions of the state:</p>
                <ul>
                    <li><strong>Twin Cities:</strong> More streamlined, typically 20-45 minutes total</li>
                    <li><strong>Northern Minnesota:</strong> Extended version, can exceed 2 hours in extreme cases</li>
                    <li><strong>Southern Minnesota:</strong> Includes agricultural updates and crop reports</li>
                    <li><strong>Iron Range:</strong> Features detailed hockey discussions and mine safety updates</li>
                </ul>
                
                <h2>Emergency Protocols</h2>
                <p>In cases where the Minnesota Goodbye threatens to extend beyond socially acceptable limits (generally considered to be 3 hours), emergency protocols may be invoked:</p>
                <ul>
                    <li>Claiming a sick relative needs attention</li>
                    <li>Referencing early morning obligations</li>
                    <li>Invoking weather-related travel concerns</li>
                    <li>The nuclear option: "The dog needs to go out"</li>
                </ul>
                
                <h2>Scientific Studies</h2>
                <p>The University of Minnesota's Department of Social Anthropology has conducted extensive research on the Minnesota Goodbye phenomenon. Their landmark 2019 study found that the average Minnesota Goodbye lasts 47 minutes, with a record-setting goodbye in Hibbing lasting 4 hours and 23 minutes (attributed to an unexpected discussion about ice fishing techniques).</p>`
            },
            'hotdish-wars': {
                title: 'The Great Hotdish Wars',
                content: `<p>The <strong>Great Hotdish Wars</strong> represent a series of ongoing culinary conflicts that have shaped Minnesota's social and political landscape since the 1960s. These "wars" consist of passionate debates, fierce competition, and occasional social ostracism over the proper preparation, ingredients, and cultural significance of hotdish.</p>
                
                <h2>Origins</h2>
                <p>The conflict began in 1963 when Mildred Kowalski of Duluth publicly declared that any hotdish containing vegetables other than corn was "an abomination against Minnesota values." This statement sparked outrage among the pro-green bean coalition, led by Agnes Olson of Rochester, who maintained that green bean hotdish was not only acceptable but superior to traditional tuna noodle varieties.</p>
                
                <h2>Major Factions</h2>
                
                <h3>The Traditionalists</h3>
                <p>Led by the powerful Tuna Noodle Alliance, traditionalists maintain that true hotdish contains only four essential elements: a protein (tuna or ground beef), a starch (noodles or rice), a vegetable (corn only), and a binding agent (cream of mushroom soup). Any deviation from this formula is considered heretical.</p>
                
                <h3>The Progressives</h3>
                <p>The Progressive Hotdish Movement advocates for culinary innovation, including the controversial addition of green beans, peas, and even more exotic ingredients like broccoli. They argue that hotdish evolution is necessary for cultural survival in modern Minnesota.</p>
                
                <h3>The Tater Tot Supremacists</h3>
                <p>This radical faction emerged in the 1970s, promoting the exclusive use of tater tots as both topping and side dish. Their militant stance that "all hotdish must be topped with tater tots or it's just casserole" has created significant social tension at church potlucks statewide.</p>
                
                <h3>The Rice Rebels</h3>
                <p>A smaller but vocal group insisting that rice-based hotdishes are equally valid. Often marginalized by the noodle majority, they continue their underground resistance through secret recipe exchanges and clandestine potluck contributions.</p>
                
                <h2>Notable Battles</h2>
                
                <h3>The Mankato Incident (1974)</h3>
                <p>A church potluck turned violent when someone brought a hotdish containing both green beans AND peas. The resulting argument split the congregation for six months, with some families changing churches entirely. The incident is still referenced in local peace-making efforts.</p>
                
                <h3>The State Fair Controversy (1987)</h3>
                <p>The Minnesota State Fair's decision to serve "Fusion Hotdish" (containing quinoa and kale) at the new foods stand nearly caused a riot. Governor Rudy Perpich was forced to intervene personally, declaring a "hotdish amnesty" and establishing the Official State Hotdish Committee.</p>
                
                <h3>The Great Cookbook Burning of 1995</h3>
                <p>When Martha Stewart published a Minnesota-inspired recipe calling hotdish "Minnesota Casserole," outraged citizens staged book burnings in seven counties. The incident led to the passage of the Hotdish Authenticity Act, making it illegal to refer to hotdish as casserole within state boundaries.</p>
                
                <h2>Current Status</h2>
                <p>While open warfare has subsided, tensions remain high. The annual Minnesota Hotdish Championship continues to be a flashpoint for conflict, with strict security measures implemented after the "Cream of Celery Riot" of 2018.</p>
                
                <p>Recent attempts at peace include the Geneva Convention on Hotdish (2020), which established basic rules of engagement for potluck attendance and recipe sharing. However, radical elements on both sides continue to reject any compromise.</p>
                
                <h2>Cultural Impact</h2>
                <p>The Hotdish Wars have profoundly influenced Minnesota society:</p>
                <ul>
                    <li>Marriage counselors now require "hotdish compatibility testing" before officiating weddings</li>
                    <li>Real estate agents must disclose neighborhood hotdish preferences to potential buyers</li>
                    <li>The phrase "we'll agree to disagree" was reportedly invented in Minnesota specifically for hotdish discussions</li>
                    <li>Emergency services maintain a "Hotdish Hotline" for potluck-related disputes</li>
                </ul>
                
                <h2>Peace Efforts</h2>
                <p>The Minnesota Department of Natural Resources recently established the Hotdish Mediation Service, staffed by trained professionals skilled in de-escalating casserole-related conflicts. Their motto: "Different toppings, same Minnesota Nice."</p>`
            },
            'lake-monster': {
                title: 'Lake Minnetonka Monster',
                content: `<div class="infobox">
                    <div class="infobox-title">Lake Minnetonka Monster</div>
                    <div class="infobox-content">
                        <div class="infobox-row">
                            <div class="infobox-label">Type:</div>
                            <div>Aquatic Cryptid</div>
                        </div>
                        <div class="infobox-row">
                            <div class="infobox-label">Location:</div>
                            <div>Lake Minnetonka, Minnesota</div>
                        </div>
                        <div class="infobox-row">
                            <div class="infobox-label">First Sighting:</div>
                            <div>1823 (disputed)</div>
                        </div>
                        <div class="infobox-row">
                            <div class="infobox-label">Length:</div>
                            <div>15-40 feet (reports vary)</div>
                        </div>
                        <div class="infobox-row">
                            <div class="infobox-label">Nickname:</div>
                            <div>"Tonka" or "Big Minnie"</div>
                        </div>
                    </div>
                </div>
                
                <p>The <strong>Lake Minnetonka Monster</strong>, affectionately known as "Tonka" or "Big Minnie," is a legendary aquatic creature said to inhabit Minnesota's Lake Minnetonka. Despite hundreds of reported sightings over nearly two centuries, the creature has managed to avoid all tourist photography, leading to its reputation as Minnesota's most camera-shy cryptid.</p>
                
                <h2>Description</h2>
                <p>Witness accounts describe the Lake Minnetonka Monster as a serpentine creature measuring between 15 and 40 feet in length, with dark green or brown coloration. Most sightings report multiple humps breaking the surface of the water, similar to other lake monsters worldwide. However, unique to Tonka are reported sightings of the creature wearing what appears to be a small winter hat during colder months.</p>
                
                <h2>Historical Sightings</h2>
                
                <h3>Early Reports (1823-1900)</h3>
                <p>The first documented sighting occurred in 1823 when fur trader Jeremiah Blackwood reported seeing "a great serpent of the lake, longer than two canoes" while trading with local Dakota peoples. Native accounts suggest awareness of the creature predates European settlement, with traditional stories referring to a "great water spirit" that protected the lake's fish populations.</p>
                
                <h3>The Steamboat Era (1900-1950)</h3>
                <p>During Lake Minnetonka's golden age as a resort destination, monster sightings peaked. The creature was reportedly attracted to the paddle wheel steamboats, with multiple witnesses aboard the steamer "Minnehaha" claiming to see Tonka following the boat in 1907. This led to the short-lived tourist attraction "Monster Watching Cruises," which were discontinued after zero successful sightings during commercial tours.</p>
                
                <h3>Modern Era (1950-Present)</h3>
                <p>Contemporary sightings continue regularly, with reports clustering around major holidays and fishing tournaments. The creature seems particularly active during the annual Minnetonka Ice Fishing Extravaganza, though ice conditions make visual confirmation challenging.</p>
                
                <h2>The Camera Phenomenon</h2>
                <p>Perhaps the most remarkable aspect of the Lake Minnetonka Monster is its apparent ability to detect and avoid photographic equipment. Statistical analysis by the University of Minnesota's Cryptozoology Department (which definitely exists) shows that Tonka sightings decrease by 97% when cameras are present.</p>
                
                <p>Theories for this phenomenon include:</p>
                <ul>
                    <li><strong>Electromagnetic Sensitivity:</strong> The creature may detect camera electronics</li>
                    <li><strong>Extreme Privacy Preference:</strong> Tonka may be naturally camera-shy</li>
                    <li><strong>Tourist Repulsion Field:</strong> The creature may have evolved a natural defense against tourism</li>
                    <li><strong>Minnesota Nice:</strong> Tonka doesn't want to cause a fuss by appearing in photos</li>
                </ul>
                
                <h2>Scientific Investigation</h2>
                <p>The Lake Minnetonka Monster Research Institute (a completely legitimate organization) has conducted extensive studies using sonar, underwater cameras, and fish finders. Their research has conclusively proven that something large definitely exists in the lake, though they admit it might just be a really big northern pike named Larry.</p>
                
                <h2>Cultural Impact</h2>
                <p>Tonka has become an important part of local culture, with several businesses adopting monster-themed names and logos. The creature serves as the unofficial mascot for the Lake Minnetonka Conservation District and appears on local tourism brochures with the caption "Tonka: Probably Real, Definitely Elusive."</p>
                
                <p>Local fishing guides report that mentioning Tonka sightings increases tourist bookings by 34%, though actual monster encounters during guided trips remain at zero percent.</p>
                
                <h2>Current Status</h2>
                <p>The Lake Minnetonka Monster continues to evade scientific documentation while maintaining a steady presence in local folklore. Recent environmental DNA testing has identified traces of "something unusual" in the lake water, though scientists note this could be explained by the presence of unusually large specimens of native fish species.</p>
                
                <p>The creature's legendary status was cemented in 2019 when it was officially declared Minnesota's "State Cryptid" by a non-binding legislative resolution, beating out competitors such as the Wendigo of the Boundary Waters and the Ghost of the Metrodome.</p>`
            }
        };

        // Navigation functions
        function showHome() {
            showArticle('home');
            updateURL('');
        }

        function showArticle(slug) {
            currentArticle = slug;
            const article = articles[slug];
            
            if (!article) {
                document.getElementById('article-content').innerHTML = `
                    <h1 class="article-title">
                        Article Not Found
                        <a href="#${slug}" class="permalink" title="Permalink to this article">#</a>
                    </h1>
                    <p>The requested article "${slug}" could not be found. Please check the navigation menu for available articles.</p>
                `;
                return;
            }

            const permalinkUrl = slug === 'home' ? '#' : `#${slug}`;
            document.getElementById('article-content').innerHTML = `
                <h1 class="article-title">
                    ${article.title}
                    <a href="${permalinkUrl}" class="permalink" title="Permalink to this article">#</a>
                </h1>
                ${article.content}
            `;
            
            // Update active navigation
            document.querySelectorAll('.sidebar a').forEach(link => {
                link.classList.remove('active');
            });
            
            const activeLink = document.querySelector(`[onclick="showArticle('${slug}')"]`) || 
                             document.querySelector(`[onclick="showHome()"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }

            // Show/hide edit form
            document.getElementById('article-content').style.display = 'block';
            document.getElementById('edit-content').style.display = 'none';
            document.getElementById('auth-content').style.display = 'none';
            document.getElementById('github-content').style.display = 'none';
            
            // Update admin dashboard if viewing admin page
            if (slug === 'admin') {
                updateAdminDashboard();
            }
            
            // Update URL if not already set correctly
            if (window.location.hash !== permalinkUrl) {
                updateURL(slug === 'home' ? '' : slug);
            }
        }

        function updateURL(slug) {
            const newHash = slug ? `#${slug}` : '';
            if (window.location.hash !== newHash) {
                history.pushState(null, null, newHash);
            }
        }

        function handleHashChange() {
            const hash = window.location.hash.slice(1); // Remove the #
            if (hash === '' || hash === 'home') {
                showArticle('home');
            } else if (articles[hash]) {
                showArticle(hash);
            } else {
                // Try to find article by slug even if it doesn't exist yet
                showArticle(hash);
            }
        }

        // Admin functions
        function handleAdminLoginKeypress(event) {
            if (event.key === 'Enter') {
                handleAdminLogin();
            }
        }

        function handleAdminLogin() {
            const password = document.getElementById('admin-login-password').value;
            
            if (password === ADMIN_PASSWORD) {
                isLoggedIn = true;
                updateAuthUI();
                updateAdminDashboard();
                showMessage('Successfully logged in as admin!', 'success');
                document.getElementById('admin-login-password').value = '';
            } else {
                showMessage('Incorrect password. Try again.', 'error');
            }
        }

        function handleAdminLogout() {
            isLoggedIn = false;
            updateAuthUI();
            updateAdminDashboard();
            showMessage('Logged out successfully.', 'success');
        }

        function updateAdminDashboard() {
            const loginSection = document.getElementById('admin-login-section');
            const dashboard = document.getElementById('admin-dashboard');
            
            if (isLoggedIn) {
                if (loginSection) loginSection.style.display = 'none';
                if (dashboard) {
                    dashboard.classList.remove('hidden');
                    updateAdminArticleList();
                }
            } else {
                if (loginSection) loginSection.style.display = 'block';
                if (dashboard) dashboard.classList.add('hidden');
            }
        }

        function updateAdminArticleList() {
            const articleList = document.getElementById('admin-article-list');
            if (!articleList) return;
            
            articleList.innerHTML = '';
            Object.keys(articles).forEach(slug => {
                if (slug !== 'admin') {
                    const article = articles[slug];
                    const li = document.createElement('li');
                    li.innerHTML = `
                        <strong>${article.title}</strong> (${slug}) 
                        <a href="#" onclick="showArticle('${slug}')" style="margin-left: 10px;">View</a>
                        <a href="#" onclick="editArticleFromAdmin('${slug}')" style="margin-left: 5px;">Edit</a>
                        <a href="#" onclick="deleteArticleFromAdmin('${slug}')" style="margin-left: 5px; color: #dc3545;">Delete</a>
                    `;
                    articleList.appendChild(li);
                }
            });
        }

        function editArticleFromAdmin(slug) {
            currentArticle = slug;
            showEditForm();
        }

        function deleteArticleFromAdmin(slug) {
            if (confirm(`Are you sure you want to delete "${articles[slug].title}"?`)) {
                delete articles[slug];
                updateNavigation();
                updateAdminArticleList();
                showMessage('Article deleted successfully.', 'success');
            }
        }

        function updateAuthUI() {
            const adminSidebar = document.getElementById('admin-sidebar');
            
            if (isLoggedIn) {
                adminSidebar.classList.remove('hidden');
            } else {
                adminSidebar.classList.add('hidden');
            }
        }

        // Data management functions
        function exportArticles() {
            const data = JSON.stringify(articles, null, 2);
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'minnesota-lore-articles.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showMessage('Articles exported successfully!', 'success');
        }

        function showImportForm() {
            document.getElementById('import-section').classList.remove('hidden');
        }

        function hideImportForm() {
            document.getElementById('import-section').classList.add('hidden');
            document.getElementById('import-data').value = '';
        }

        function importArticles() {
            const data = document.getElementById('import-data').value.trim();
            
            if (!data) {
                showMessage('Please paste JSON data to import.', 'error');
                return;
            }
            
            try {
                const importedArticles = JSON.parse(data);
                
                // Validate structure
                for (const slug in importedArticles) {
                    if (!importedArticles[slug].title || !importedArticles[slug].content) {
                        throw new Error('Invalid article structure');
                    }
                }
                
                // Merge articles
                Object.assign(articles, importedArticles);
                updateNavigation();
                updateAdminArticleList();
                hideImportForm();
                showMessage('Articles imported successfully!', 'success');
                
            } catch (error) {
                showMessage('Invalid JSON data. Please check the format.', 'error');
            }
        }

        // GitHub integration functions - TiddlyWiki style
        function generateWikiHTML() {
            // Get the current HTML document
            const currentHTML = document.documentElement.outerHTML;
            
            // Extract the articles data
            const articlesData = JSON.stringify(articles, null, 4);
            
            // Create the updated HTML with embedded articles data
            const articleDataScript = `let articles = ${articlesData};`;
            
            // Replace the articles data in the script
            const updatedHTML = currentHTML.replace(
                /let articles = \{[\s\S]*?\};/,
                articleDataScript
            );
            
            // Update the last modified timestamp
            const timestampScript = `wikiData.lastModified = '${new Date().toISOString()}';`;
            const finalHTML = updatedHTML.replace(
                /wikiData\.lastModified = '[^']*';/,
                timestampScript
            );
            
            return finalHTML;
        }

        async function saveWikiToGitHub() {
            if (!githubConfig.token || !githubConfig.owner || !githubConfig.repo || !githubConfig.path) {
                showMessage('Please configure GitHub settings first.', 'error');
                return;
            }
            
            try {
                // Get current file SHA if it exists (needed for updates)
                let fileSha = null;
                try {
                    const fileResponse = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.path}?ref=${githubConfig.branch}`, {
                        headers: {
                            'Authorization': `token ${githubConfig.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (fileResponse.ok) {
                        const fileData = await fileResponse.json();
                        fileSha = fileData.sha;
                    }
                } catch (e) {
                    // File doesn't exist yet, which is fine
                }
                
                // Generate the complete wiki HTML
                const wikiHTML = generateWikiHTML();
                const encodedContent = btoa(unescape(encodeURIComponent(wikiHTML))); // Encode to base64
                
                const payload = {
                    message: `Update Minnesota Lore Wiki - ${new Date().toISOString()}`,
                    content: encodedContent,
                    branch: githubConfig.branch
                };
                
                if (fileSha) {
                    payload.sha = fileSha; // Required for updates
                }
                
                const response = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.path}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    wikiData.lastModified = new Date().toISOString();
                    showMessage(`Wiki saved to GitHub successfully! View at: https://${githubConfig.owner}.github.io/${githubConfig.repo}/`, 'success');
                } else {
                    const error = await response.json();
                    showMessage(`Save failed: ${error.message}`, 'error');
                }
            } catch (error) {
                showMessage(`Save error: ${error.message}`, 'error');
            }
        }

        async function loadWikiFromGitHub() {
            if (!githubConfig.token || !githubConfig.owner || !githubConfig.repo || !githubConfig.path) {
                showMessage('Please configure GitHub settings first.', 'error');
                return;
            }
            
            try {
                const response = await fetch(`https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.path}?ref=${githubConfig.branch}`, {
                    headers: {
                        'Authorization': `token ${githubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const file = await response.json();
                    const content = atob(file.content); // Decode base64
                    
                    // Extract articles from the HTML content
                    const articlesMatch = content.match(/let articles = (\{[\s\S]*?\});/);
                    if (articlesMatch) {
                        const githubArticles = JSON.parse(articlesMatch[1]);
                        
                        // Preserve the current admin article
                        const adminArticle = articles.admin;
                        articles = githubArticles;
                        articles.admin = adminArticle;
                        
                        updateNavigation();
                        updateAdminArticleList();
                        showMessage('Wiki loaded from GitHub successfully!', 'success');
                    } else {
                        showMessage('Could not find articles data in the GitHub file.', 'error');
                    }
                } else if (response.status === 404) {
                    showMessage('Wiki file not found in GitHub. Save your wiki first.', 'error');
                } else {
                    const error = await response.json();
                    showMessage(`Load failed: ${error.message}`, 'error');
                }
            } catch (error) {
                showMessage(`Load error: ${error.message}`, 'error');
            }
        }
        function showEditForm() {
            if (!isLoggedIn) {
                showMessage('You must be logged in to edit articles.', 'error');
                return;
            }
            
            const article = articles[currentArticle];
            if (!article) return;
            
            document.getElementById('edit-title').value = article.title;
            document.getElementById('edit-slug').value = currentArticle;
            document.getElementById('edit-content-area').value = article.content;
            
            document.getElementById('article-content').style.display = 'none';
            document.getElementById('edit-content').style.display = 'block';
            document.getElementById('auth-content').style.display = 'none';
        }

        function showNewArticleForm() {
            if (!isLoggedIn) {
                showMessage('You must be logged in to create articles.', 'error');
                return;
            }
            
            document.getElementById('edit-title').value = '';
            document.getElementById('edit-slug').value = '';
            document.getElementById('edit-content-area').value = '';
            
            document.getElementById('article-content').style.display = 'none';
            document.getElementById('edit-content').style.display = 'block';
            document.getElementById('auth-content').style.display = 'none';
        }

        function saveArticle(event) {
            event.preventDefault();
            
            if (!isLoggedIn) {
                showMessage('You must be logged in to save articles.', 'error');
                return;
            }
            
            const title = document.getElementById('edit-title').value.trim();
            const slug = document.getElementById('edit-slug').value.trim().toLowerCase();
            const content = document.getElementById('edit-content-area').value.trim();
            
            if (!title || !slug || !content) {
                showMessage('All fields are required.', 'error');
                return;
            }
            
            // Validate slug format
            if (!/^[a-z0-9-]+$/.test(slug)) {
                showMessage('Slug must contain only lowercase letters, numbers, and hyphens.', 'error');
                return;
            }
            
            articles[slug] = { title, content };
            updateNavigation();
            updateURL(slug);
            showArticle(slug);
            showMessage('Article saved successfully!', 'success');
        }

        function deleteCurrentArticle() {
            if (!isLoggedIn) {
                showMessage('You must be logged in to delete articles.', 'error');
                return;
            }
            
            if (currentArticle === 'home') {
                showMessage('Cannot delete the home page.', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to delete this article? This action cannot be undone.')) {
                delete articles[currentArticle];
                updateNavigation();
                showHome();
                showMessage('Article deleted successfully.', 'success');
            }
        }

        function cancelEdit() {
            showArticle(currentArticle);
        }

        // Utility functions
        function updateNavigation() {
            const articleList = document.getElementById('article-list');
            articleList.innerHTML = '<li><a href="#" onclick="showHome()">Main Page</a></li>';
            articleList.innerHTML += '<li><a href="#admin" onclick="showArticle(\'admin\')">Admin Panel</a></li>';
            
            Object.keys(articles).forEach(slug => {
                if (slug !== 'home' && slug !== 'admin') {
                    const article = articles[slug];
                    articleList.innerHTML += `<li><a href="#${slug}" onclick="showArticle('${slug}')">${article.title}</a></li>`;
                }
            });
        }

        function handleSearch(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }

        function performSearch() {
            const searchInput = document.getElementById('search-input');
            const query = searchInput.value.toLowerCase().trim();
            
            if (!query) {
                showMessage('Please enter a search term.', 'error');
                return;
            }
            
            console.log('Searching for:', query); // Debug log
            console.log('Available articles:', Object.keys(articles)); // Debug log
            
            const results = [];
            
            // Search through all articles
            for (const slug in articles) {
                const article = articles[slug];
                const titleMatch = article.title.toLowerCase().includes(query);
                const contentMatch = article.content.toLowerCase().includes(query);
                
                if (titleMatch || contentMatch) {
                    results.push({
                        slug: slug,
                        title: article.title,
                        titleMatch: titleMatch
                    });
                }
            }
            
            console.log('Search results:', results); // Debug log
            
            if (results.length > 0) {
                // Prioritize title matches over content matches
                results.sort((a, b) => {
                    if (a.titleMatch && !b.titleMatch) return -1;
                    if (!a.titleMatch && b.titleMatch) return 1;
                    return 0;
                });
                
                const firstResult = results[0].slug;
                console.log('Navigating to:', firstResult); // Debug log
                
                searchInput.value = '';
                
                if (firstResult === 'home') {
                    updateURL('');
                    showArticle('home');
                } else {
                    updateURL(firstResult);
                    showArticle(firstResult);
                }
                
                showMessage(`Found ${results.length} result(s). Showing: ${results[0].title}`, 'success');
            } else {
                showMessage(`No articles found matching "${query}".`, 'error');
            }
        }

        function showMessage(message, type) {
            // Remove existing messages
            const existingMessages = document.querySelectorAll('.error, .success');
            existingMessages.forEach(msg => msg.remove());
            
            // Create new message
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            
            // Insert at top of content area
            const content = document.querySelector('.content');
            content.insertBefore(messageDiv, content.firstChild);
            
            // Remove after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        // Initialize - try to load from GitHub on startup
        document.addEventListener('DOMContentLoaded', function() {
            updateAuthUI();
            
            // Handle initial hash
            handleHashChange();
            
            // Listen for hash changes (back/forward buttons)
            window.addEventListener('hashchange', handleHashChange);
            
            // Try to load wiki from GitHub automatically
            loadWikiFromGitHub().catch(() => {
                // If loading fails, just use the default articles
                console.log('Could not load from GitHub, using default articles');
            });
        });
    </script>
                    
